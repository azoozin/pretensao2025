<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulário Infantil</title>
  <style>
    body {
      font-family: "Arial Rounded MT Bold", sans-serif;
      background-color: #e0f7fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
    }

    #form,
    .welcome {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 20px;
      border: 5px dashed #4db6ac;
      margin-bottom: 20px;
      box-sizing: border-box;
    }

    h1,
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #00796b;
      font-family: "Arial Rounded MT Bold", sans-serif;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #004d40;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    input[type="tel"],
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid #4db6ac;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="number"]:focus,
    input[type="tel"]:focus,
    select:focus {
      border-color: #00796b;
      outline: none;
    }

    #submit {
      width: 100%;
      padding: 12px;
      background-color: #ff7043;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #submit:hover {
      background-color: #ff5722;
    }

    #submit:disabled {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .separator {
      border: none;
      height: 2px;
      background-color: #4db6ac;
      margin: 20px 0;
    }

    .clearfix::after {
      content: "";
      clear: both;
      display: table;
      align-self: center;
    }

    /* Responsive design */
    @media (max-width: 768px) {

      #form,
      .welcome {
        padding: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="welcome" style="text-align: center">
      <h2>Bem-vindos ao Portal de Matrículas!</h2>
      <p>
        Sejam bem-vindos ao Portal de Pretensões de Matrículas para o Ano
        Letivo de 2025.
      </p>
      <p>
        Informamos que a pretensão de vaga é somente para crianças que não
        estão matriculadas em nenhuma instituição da Rede Municipal de
        Educação, que são os CMEIs, CEIs Conveniados e CEIs Particulares.
      </p>
      <p>
        Obs: A instituição escolhida como 1ª opção entrará em contato para
        entrega de documentação para comprovação dos dados cadastrados. O
        contato será via ligação telefônica, no período de 13/11/2024 à
        22/11/2024.
      </p>
    </div>
    <form method="post" id="form"
      action="https://script.google.com/macros/s/AKfycbwPzkHUBqeQaHHk5zOnKQZX2dpnsAxEBS2bwQFby-WTIs3fj89QRn5EVTzsmRUcZ1Ny/exec">
      <h1>Dados do Responsável</h1>
      <label for="nome_responsavel">Nome do Responsável</label>
      <input type="text" name="nome_responsavel" id="nome_responsavel" required maxlength="60" />

      <label for="cpf_responsavel">CPF do Responsável</label>
      <input type="text" name="cpf_responsavel" id="cpf_responsavel" required oninput="formatCPF(this)" />

      <label for="email">Email</label>
      <input type="email" name="email" id="email" required />

      <label for="telefone">Telefone</label>
      <input type="tel" name="telefone" id="telefone" maxlength="14" required oninput="formatTelefone(this)" />

      <label for="renda">Renda por Pessoa</label>
      <input type="text" name="renda" id="renda" required maxlength="14" oninput="formatRenda(this)" />

      <hr class="separator" />

      <h1>Endereço</h1>
      <label for="rua">Rua</label>
      <input type="text" name="rua" id="rua" required maxlength="60" />

      <label for="numero">Número</label>
      <input type="text" name="numero" id="numero" required maxlength="10" oninput="formatNum(this)" />

      <label for="bairro">Bairro</label>
      <input type="text" name="bairro" id="bairro" required maxlength="30" />

      <label for="cep">CEP</label>
      <input type="text" name="cep" id="cep" required oninput="formatCEP(this)" />

      <hr class="separator" />

      <h1>Dados da Criança</h1>
      <label for="nome_crianca">Nome da Criança</label>
      <input type="text" name="nome_crianca" id="nome_crianca" required maxlength="60" />

      <label for="data_nascimento">Data de Nascimento</label>
      <input type="date" name="data_nascimento" id="data_nascimento" required oninput="updateTurma()" />

      <label for="turma">Turma</label>
      <input type="text" id="turma" placeholder="" readonly />

      <label for="cartao_sus">Cartão SUS</label>
      <input type="text" name="cartao_sus" id="cartao_sus" maxlength="15" required oninput="formatSUS(this)" />

      <hr class="separator" />

      <h1>Instituições de Escolha</h1>
      <label for="escola">Primeira Opção</label>
      <select name="escola" id="escola" disabled required>
        <option value="" disabled selected>Escolha uma Instituição</option>
      </select>

      <label for="escola2">Segunda Opção</label>
      <select name="escola2" id="escola2" disabled required>
        <option value="" disabled selected>Escolha uma Instituição</option>
      </select>

      <label for="escola3">Terceira Opção</label>
      <select name="escola3" id="escola3" disabled required>
        <option value="" disabled selected>Escolha uma Instituição</option>
      </select>

      <input type="submit" id="submit" value="Enviar" disabled />
      <div id="responseMessage" style="
            text-align: center;
            color: green;
            visibility: hidden;
            margin-bottom: 15px;
            margin-top: 15px;
          "></div>
    </form>
  </div>

  <script>
    // Your JavaScript code goes here

    window.onload = function () {
      // Clear the form fields on page load
      document.getElementById("form").reset()
      document.getElementById("submit").disabled = true
    }

    window.addEventListener("load", function () {
      const form = document.getElementById("form")
      const responseMessage = document.getElementById("responseMessage")
      form.addEventListener("submit", function (e) {
        e.preventDefault()
        const data = new FormData(form)

        for (let [key, value] of data.entries()) {
          data.set(key, value.toUpperCase())
        }

        const action = e.target.action
        fetch(action, {
          method: "POST",
          body: data,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok")
            }
            return response.json()
          })
          .then((data) => {
            document.getElementById("form").reset()
            document.getElementById("submit").disabled = true
            responseMessage.textContent = `Formulário enviado com sucesso! Protocolo: ${data.protocol}`
            responseMessage.style.visibility = "visible"
          })
          .catch((error) => {
            console.error("Error:", error)
          })
      })
    })

    // Formatting functions

    function formatNum(input) {
      const value = input.value.replace(/\D/g, "")
      input.value = value
    }

    function formatCEP(input) {
      const value = input.value.replace(/\D/g, "")
      if (value.length > 5) {
        input.value = value.slice(0, 5) + "-" + value.slice(5, 8)
      } else {
        input.value = value
      }
    }

    function formatTelefone(input) {
      const value = input.value.replace(/\D/g, "") // Remove non-digit characters

      if (value.length === 10) {
        // Format for 10 digits: (xx)xxxx-xxxx
        input.value =
          "(" +
          value.slice(0, 2) +
          ")" +
          value.slice(2, 6) +
          "-" +
          value.slice(6)
      } else if (value.length === 11) {
        // Format for 11 digits: (xx)xxxxx-xxxx
        input.value =
          "(" +
          value.slice(0, 2) +
          ")" +
          value.slice(2, 7) +
          "-" +
          value.slice(7)
      } else {
        // If not 10 or 11 digits, just show the raw value
        input.value = value
      }
    }

    function formatSUS(input) {
      const value = input.value.replace(/\D/g, "")
      input.value = value
    }

    function formatCPF(input) {
      const value = input.value.replace(/\D/g, "") // Remove non-digit characters

      // Validate CPF length
      if (value.length > 11) {
        input.value = value.slice(0, 11) // Limit to 11 digits
        return
      }

      // Format the CPF
      if (value.length === 11) {
        input.value =
          value.slice(0, 3) +
          "." +
          value.slice(3, 6) +
          "." +
          value.slice(6, 9) +
          "-" +
          value.slice(9)

        // Validate the CPF
        if (!isValidCPF(value)) {
          alert("CPF inválido!") // You can change this to whatever feedback you prefer
          input.value = "" // Clear the input if invalid
        }
      } else {
        // If not 11 digits, just show the raw value
        input.value = value
      }
    }

    function isValidCPF(cpf) {
      // Check if all digits are the same
      if (/^(\d)\1{10}$/.test(cpf)) {
        return false // Invalid CPF (e.g., 111.111.111-11)
      }

      // CPF validation logic
      let sum = 0
      let remainder

      // Validate first check digit
      for (let i = 1; i <= 9; i++) {
        sum += parseInt(cpf.charAt(i - 1)) * (11 - i)
      }
      remainder = (sum * 10) % 11
      if (remainder === 10 || remainder === 11) {
        remainder = 0
      }
      if (remainder !== parseInt(cpf.charAt(9))) {
        return false // Invalid CPF
      }

      sum = 0 // Reset sum for the second check digit
      for (let i = 1; i <= 10; i++) {
        sum += parseInt(cpf.charAt(i - 1)) * (12 - i)
      }
      remainder = (sum * 10) % 11
      if (remainder === 10 || remainder === 11) {
        remainder = 0
      }
      return remainder === parseInt(cpf.charAt(10)) // Valid CPF if both check digits match
    }

    function formatRenda(input) {
      const value = input.value.replace(/\D/g, "")
      input.value = value
        .replace(/(\d)(\d{2})$/, "$1,$2")
        .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.")
      if (!value) input.value = ""
      input.value = "R$ " + input.value
    }

    // Função para atualizar a turma com base na data de nascimento
    function updateTurma() {
      const dobInput = document.getElementById("data_nascimento").value
      const turmaInput = document.getElementById("turma")

      if (dobInput) {
        const [year, month, day] = dobInput.split("-").map(Number)
        const dob = new Date(year, month - 1, day) // mês é 0-indexado

        // Define os intervalos de data para cada turma
        const maternal2Start = new Date(2021, 3, 1)
        const maternal2End = new Date(2022, 2, 31)
        const maternal1Start = new Date(2022, 3, 1)
        const maternal1End = new Date(2023, 2, 31)
        const berçario2Start = new Date(2023, 3, 1)
        const berçario2End = new Date(2024, 2, 31)
        const berçario1Start = new Date(2024, 3, 1)
        const berçario1End = new Date(2024, 6, 20)

        // Determina a turma com base na data de nascimento
        if (dob >= maternal2Start && dob <= maternal2End) {
          turmaInput.value = "Maternal 2"
        } else if (dob >= maternal1Start && dob <= maternal1End) {
          turmaInput.value = "Maternal 1"
        } else if (dob >= berçario2Start && dob <= berçario2End) {
          turmaInput.value = "Berçário 2"
        } else if (dob >= berçario1Start && dob <= berçario1End) {
          turmaInput.value = "Berçário 1"
        } else {
          turmaInput.value = "" // Limpa se não houver correspondência
        }

        // Atualiza as opções de escolas
        populateSchoolOptions()
      } else {
        turmaInput.value = "" // Limpa se não houver data
      }
    }

    const schools = [
      "CMEI ALVINA GOLDINHO SILVESTRE (Mandiocaba)",
      "CMEI ALZIRA MENDONÇA FIGUEIRA (Conj Flavio Giovine)",
      "CMEI ANTONIA AYRES DE OLIVEIRA (Monte Cristo)",
      "CMEI AVELINO DAL-PRÁ (3 Conjuntos)",
      "CMEI AYRTON SENNA DA SILVA-CAIC (Vila Operaria)",
      "CMEI CECILIA VECHIATTI GIOVINE (Simone)",
      "CMEI JACÓ DE JESUS SOUZA (Vila Operaria)",
      "CMEI LUCILENE DOS SANTOS RODRIGUES (São Jorge)",
      "CMEI MARIA MADALENA FERNANDES DE SOUZA (Morumbi)",
      "CMEI MENINA ISABELA DE SOUZA DA SILVA (Ouro Branco)",
      "CMEI MENINO DAVI (Vila Operaria)",
      "CMEI NOSSA SENHORA DO CARMO GRACIOSA",
      "CMEI NOSSA SENHORA DO CARMO PARANAVAÍ (Jd. Maringa)",
      "CMEI ROSÂNGELA BERTO CASSORILLO (Centro)",
      "CMEI TIA IRENE MARTOS ROCHA (Sumaré)",
      "CEI ANÍBAL AGITA (Centro)",
      "CEI INFÂNCIA FELIZ (Sumaré)",
      "CEI EDUCANDÁRIO SÃO JOSÉ (Ipê)",
      "CEI PEQUENINOS DE SANTA RITA (Morumbi)",
      "CEI SANTA TEREZNHA DO MENINO JESUS (Santos Dumont)",
      "CEI SEMENTE DA ESPERANÇA (São Jorge)",
      "CEI PEQUENO SEMELHANTE (São Jorge)",
      "CEI CASA DA CRIANÇA (Vila Operaria)",
    ]

    const schoolsB1 = [
      "CMEI ALVINA GOLDINHO SILVESTRE (Mandiocaba)",
      "CMEI ALZIRA MENDONÇA FIGUEIRA (Conj Flavio Giovine)",
      "CMEI ANTONIA AYRES DE OLIVEIRA (Monte Cristo)",
      "CMEI AVELINO DAL-PRÁ (3 Conjuntos)",
      "CMEI AYRTON SENNA DA SILVA-CAIC (Vila Operaria)",
      "CMEI CECILIA VECHIATTI GIOVINE (Simone)",
      "CMEI JACÓ DE JESUS SOUZA (Vila Operaria)",
      "CMEI LUCILENE DOS SANTOS RODRIGUES (São Jorge)",
      "CMEI MENINA ISABELA DE SOUZA DA SILVA (Ouro Branco)",
      "CMEI MENINO DAVI (Vila Operaria)",
      "CMEI NOSSA SENHORA DO CARMO GRACIOSA",
      "CMEI NOSSA SENHORA DO CARMO PARANAVAÍ (Jd. Maringa)",
      "CMEI ROSÂNGELA BERTO CASSORILLO (Centro)",
      "CMEI TIA IRENE MARTOS ROCHA (Sumaré)",
      "CEI ANÍBAL AGITA (Centro)",
      "CEI SANTA TEREZNHA DO MENINO JESUS (Santos Dumont)",
    ]

    function populateSchoolOptions() {
      const turmaValue = document.getElementById("turma").value
      const selects = [
        document.getElementById("escola"),
        document.getElementById("escola2"),
        document.getElementById("escola3"),
      ]

      if (turmaValue == "") {
        selects.forEach((select) => {
          select.disabled = true
          select.innerHTML =
            '<option value="" disabled selected>Escolha uma Instituição</option>'
        })
      } else if (turmaValue == "Berçário 1") {
        selects.forEach((select) => {
          select.disabled = true
          select.innerHTML =
            '<option value="" disabled selected>Escolha uma Instituição</option>'
          schoolsB1.forEach((school) => {
            const option = document.createElement("option")
            option.value = school
            option.textContent = school
            select.appendChild(option)
          })
          select.disabled = false
        })
      } else {
        selects.forEach((select) => {
          select.disabled = true
          select.innerHTML =
            '<option value="" disabled selected>Escolha uma Instituição</option>'
          schools.forEach((school) => {
            const option = document.createElement("option")
            option.value = school
            option.textContent = school
            select.appendChild(option)
          })
          select.disabled = false
        })
      }
    }

    function updateSchoolOptions() {
      const selects = [
        document.getElementById("escola"),
        document.getElementById("escola2"),
        document.getElementById("escola3"),
      ]

      const selectedSchools = [
        document.getElementById("escola").value,
        document.getElementById("escola2").value,
        document.getElementById("escola3").value,
      ]

      selects.forEach((select, index) => {
        Array.from(select.options).forEach((option) => {
          if (
            selectedSchools.includes(option.value) &&
            option.value !== select.value
          ) {
            option.style.display = "none"
          } else {
            option.style.display = "block"
          }
        })
      })
    }

    // Add event listeners for each select
    document
      .getElementById("escola")
      .addEventListener("change", updateSchoolOptions)
    document
      .getElementById("escola2")
      .addEventListener("change", updateSchoolOptions)
    document
      .getElementById("escola3")
      .addEventListener("change", updateSchoolOptions)

    const inputs = document.querySelectorAll(
      "#form input[required], #form select[required]",
    )
    inputs.forEach((input) => {
      input.addEventListener("input", updateSubmitButton)
    })

    function updateSubmitButton() {
      const allFilled = [...inputs].every((input) => input.value)
      document.getElementById("submit").disabled = !allFilled
    }
  </script>
</body>

</html>